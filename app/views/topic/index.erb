<h1>
  <a href="/<%= @topic.user %>"><%= @topic.user %></a> /
  <a href="/<%= @topic.user %>/<%= @topic %>"><%= @topic %></a>
</h1>

<% form_tag url(:topic, :fork), :method => 'post' do %>
  <table id="messages">
    <% day = nil %>
    <% @topic.messages.each do |msg| %>
      <% if day != msg.created_at.strftime('%D') %>
        <% day = msg.created_at.strftime('%D') %>
        <tr>
          <td colspan="3"><%= day %></td>
        </tr>
      <% end %>
      <tr>
        <td><%= check_box_tag 'message_id[]', :value => msg.id, :class => 'message_id' %></td>
        <td>&lt; <%= msg.user %> <%= msg.created_at.strftime('%T') %> &gt;</td>
        <td><%= msg.text %></td>
      </tr>
    <% end %>
  </table>

  <% if !@topic.messages.empty? %>
    <%= hidden_field_tag :topic_id, :value => @topic.id %>
    <%= text_field_tag :new_topic_name %>
    <%= submit_tag "Fork" %>
  <% end %>
<% end %>

<% form_tag url(:message, :new), :method => 'post' do %>
  <p>
    <%= flash_tag :notice %>
  </p>
  <p>
    <%= hidden_field_tag :topic_id, :value => @topic.id %>
    <%= text_field_tag :text %>
    <%= submit_tag "Post" %>
  </p>
<% end %>
